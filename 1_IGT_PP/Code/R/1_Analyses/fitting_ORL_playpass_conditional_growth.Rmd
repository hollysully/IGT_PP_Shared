---
title: "Fitting Joint Test-Retest ORL"
output: html_document
date: "2023-03-07"
---



# -------------------------------------------
# Setup
## Load Packages
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(rstan)
library(hBayesDM)
library(bayesplot)
library(here)
library(miscTools)
library(cmdstanr)
library(stringi)
library(foreach)
source(here("1_TADS_long", "Code", "R", "3_Other", "helpful_functions.R"))
source(here("1_IGT_PP", "Code", "R", "utils.R"))
```


## Load Data
```{r}
all_task_data <- readRDS(here("1_IGT_PP", "Data", "1_Preprocessed", "all_task_data.rds"))
all_survey_data <- readRDS(here("1_IGT_PP", "Data", "1_Preprocessed", "all_survey_data.rds"))
```

# Fit Model
```{r, eval = T}
# Compile model
orl_model <- cmdstan_model(here("1_IGT_PP", "Code", "Stan", "igt_orl_playpass_conditional_growth.stan"))

model_text <- "
  Arew ~ 1;
  Apun ~ 1;
  betaF ~ 1;
  betaP ~ 1
"

stan_data <- make_stan_data_growth(
  all_task_data, 
  all_survey_data,
  model_text,
  "session"
)

# Fit model
orl_fit <- orl_model$sample(
  stan_data, 
  iter_sampling = 200, 
  iter_warmup = 100, 
  chains = 6, 
  parallel_chains = 6,
  seed = 43210
) 
```
